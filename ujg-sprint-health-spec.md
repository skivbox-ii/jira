# UJG Sprint Health — Виджет оценки качества планирования спринта

## Цель
Визуализировать "здоровье" спринта: насколько хорошо он спланирован, есть ли проблемы, которые нужно исправить до старта или в процессе работы.

---

## Основные метрики

### 1. Заполненность спринта (Capacity)
- **Взято в спринт**: Σ часов (time estimate) всех задач
- **Capacity команды**: сумма доступных часов участников (можно задать вручную)
- **% заполнения**: показывать прогресс-бар и предупреждение при перегрузке (>100%)
- Отдельно показать: сколько часов у каждого участника vs его capacity

### 2. Оценка задач (Estimation) — В ЧАСАХ
- **Без оценки**: список задач без time estimate (Original Estimate)
- **% оцененных**: прогресс-бар
- **Слишком крупные**: задачи с оценкой > N часов (настраиваемый порог, например >16ч)
- **Статус**: ✅ "Все оценено" или ⚠️ "X задач без оценки"

### 3. Сроки (Due Dates)
- **Без срока**: список задач без дат (начало/конец)
- **% с проставленным сроком**: прогресс-бар
- **Просроченные**: задачи с due date в прошлом
- **Конфликты**: несколько задач с одинаковым due date у одного исполнителя

### 4. Назначение исполнителей (Assignee)
- **Без исполнителя**: список задач без assignee
- **% назначенных**: прогресс-бар
- **Распределение нагрузки**: таблица или bar-chart по каждому участнику (часы / кол-во задач)
- **Перегруз**: выделить участников с нагрузкой > их capacity

### 5. Приоритеты (Priority)
- **Распределение**: bar-chart по приоритетам (Critical, High, Medium, Low)
- **Без приоритета**: список задач без приоритета
- **Дисбаланс**: предупреждение если слишком много Critical/High

### 6. Типы задач (Issue Types)
- **Распределение**: Story vs Bug vs Task vs Sub-task
- **Баланс**: предупреждение если в спринте только баги или только stories

### 7. Описание и готовность (Definition of Ready)
- **Без описания**: задачи с пустым description
- **Готовность к разработке**: % задач, удовлетворяющих DoR

### 8. Риски и проблемы (Risks)
- Задачи-блокеры с высоким приоритетом без оценки
- Задачи зависящие от внешних команд (по меткам)
- Задачи, которые переносились из прошлых спринтов (rollover)
- Очень старые задачи (созданы давно, но не закрыты)

### 9. Кривая сгорания (Burndown Chart)
- **Переключатель режима**: [Часы] / [Задачи]
- **Режим "Часы"**: ось Y — оставшиеся часы работы (remaining estimate)
- **Режим "Задачи"**: ось Y — количество незакрытых задач
- **Идеальная линия**: от общего объёма к нулю за время спринта
- **Фактическая линия**: текущий остаток (часы или задачи)
- **Отклонение**: показать насколько отстаём/опережаем план

### 10. Диаграмма накопления (Burnup Chart)
- **Scope линия (верхняя)**: общий объём работы (может расти если добавляют задачи!)
- **Done линия (нижняя)**: сколько уже сделано
- **Цель**: линии должны сойтись к концу спринта
- **Плюс**: видно изменение scope (если заказчик добавляет задачи в спринт)

### 11. Cumulative Flow Diagram (CFD)
- **Области по статусам**: To Do, In Progress, In Review, Done
- **Ось X**: дни спринта
- **Ось Y**: количество задач (stacked area chart)
- **Анализ**:
  - Расширение зоны "In Progress" → WIP растёт (проблема!)
  - Сужение зоны "To Do" при росте "Done" → нормальный прогресс
  - Flat линия "Done" → команда буксует

### 12. Velocity (сравнение спринтов)
- **Bar chart**: сколько часов/задач закрыто за последние N спринтов
- **Средняя velocity**: для прогнозирования
- **Commitment vs Done**: что планировали vs что сделали

### 13. Scope Change (изменение объёма)
- **Добавлено после старта**: +N задач / +X часов
- **Убрано из спринта**: -M задач / -Y часов
- **% изменения scope**: предупреждение если >20%

### 14. Aging WIP (застрявшие задачи)
- Задачи в статусе "In Progress" более N дней
- Цветовая индикация: жёлтый >3 дня, красный >5 дней
- Помогает найти "зависшие" задачи

### 15. Cycle Time Distribution
- **Гистограмма**: сколько задач закрывается за 1 день, 2 дня, 3+ дней
- **Средний Cycle Time**: от "In Progress" до "Done"
- **Outliers**: задачи с аномально долгим временем

---

## UI/UX

### Макет панели
```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│ [▼ Спринт: Sprint 23]  [🔄 Обновить]                                            [⛶ На весь экран] │
├─────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                     │
│  ОБЩАЯ ОЦЕНКА: ██████████░░ 78%  — "Хорошо, но есть замечания"                                     │
│                                                                                                     │
├───────────────┬───────────────┬───────────────┬─────────────────────────────────────────────────────┤
│ 📊 Capacity   │ 📝 Оценки     │ 📅 Сроки      │ 👤 Исполнители                                      │
│ ████████░░    │ ██████████    │ ██████░░░░    │ ████████░░                                          │
│ 84/100 ч      │ 100%          │ 60%           │ 85%                                                 │
│ ✅ Норма      │ ✅ Отлично    │ ⚠️ 4 без срока│ ⚠️ 2 без assignee                                  │
├───────────────┴───────────────┴───────────────┴─────────────────────────────────────────────────────┤
│                                                                                                     │
│  BURNDOWN CHART (Кривая сгорания)                      [● Часы] [○ Задачи]                         │
│  ┌────────────────────────────────────────────────────────────────────────────┐                    │
│  │ 100ч ─┐                                                                    │  ← режим "Часы"   │
│  │       │ ╲                                                                  │                    │
│  │  80ч ─┤   ╲ ─ ─ идеал                                                     │                    │
│  │       │    ●────●                                                          │                    │
│  │  60ч ─┤          ╲   ●───● факт                                           │                    │
│  │       │           ╲       ╲                                                │                    │
│  │  40ч ─┤            ╲       ●                                               │                    │
│  │       │             ╲                                                      │                    │
│  │  20ч ─┤              ╲                                                     │                    │
│  │       │               ╲                                                    │                    │
│  │   0ч ─┴───────────────────────────────────────────────────────────────────│                    │
│  │       Пн   Вт   Ср   Чт   Пт   Пн   Вт   Ср   Чт   Пт                     │                    │
│  └────────────────────────────────────────────────────────────────────────────┘                    │
│                                                                                                     │
│  Режим "Задачи": вместо часов — количество незакрытых задач (12 → 0)                               │
│                                                                                                     │
├─────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                     │
│  BURNUP CHART (Диаграмма накопления)                                                               │
│  ┌────────────────────────────────────────────────────────────────────────────┐                    │
│  │ 120ч ─┤                              ┌─────────────── scope (добавили!)    │                    │
│  │ 100ч ─┤─────────────────────────────┘                                      │                    │
│  │       │                                                 ●───● done         │                    │
│  │  80ч ─┤                                           ●────┘                   │                    │
│  │       │                                     ●────┘                         │                    │
│  │  60ч ─┤                               ●────┘                               │                    │
│  │       │                         ●────┘                                     │                    │
│  │  40ч ─┤                   ●────┘                                           │                    │
│  │       │             ●────┘                                                 │                    │
│  │  20ч ─┤       ●────┘                                                       │                    │
│  │       │ ●────┘                                                             │                    │
│  │   0ч ─┴───────────────────────────────────────────────────────────────────│                    │
│  │       Пн   Вт   Ср   Чт   Пт   Пн   Вт   Ср   Чт   Пт                     │                    │
│  └────────────────────────────────────────────────────────────────────────────┘                    │
│  ⚠️ Scope вырос на 20ч (+20%) — добавлены задачи после старта спринта                             │
│                                                                                                     │
├─────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                     │
│  CFD (Cumulative Flow)                           VELOCITY (последние 5 спринтов)                   │
│  ┌────────────────────────────────┐              ┌─────────────────────────────────┐               │
│  │ ████████████████████████ Done  │              │ Sprint 19:  ████████░░  80ч     │               │
│  │ ░░░░████████████████████       │              │ Sprint 20:  ██████████  100ч    │               │
│  │ ░░░░░░░░░░░░████████████ In Pr │              │ Sprint 21:  ████████░░  85ч     │               │
│  │ ░░░░░░░░░░░░░░░░████████       │              │ Sprint 22:  █████████░  95ч     │               │
│  │ ░░░░░░░░░░░░░░░░░░░░████ To Do │              │ Sprint 23:  ██████░░░░  60ч ◄   │               │
│  │ Пн Вт Ср Чт Пт Пн Вт Ср Чт Пт  │              │             ──────────          │               │
│  └────────────────────────────────┘              │ Avg: 84ч    Plan: 100ч          │               │
│                                                  └─────────────────────────────────┘               │
│                                                                                                     │
├─────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                     │
│  SCOPE CHANGE                                    AGING WIP (зависшие задачи)                       │
│  ┌────────────────────────────────┐              ┌─────────────────────────────────┐               │
│  │ Было на старте:     100ч (10)  │              │ 🔴 PROJ-45  In Progress  7 дней │               │
│  │ + Добавлено:        +20ч (+2)  │              │ 🟠 PROJ-67  In Progress  5 дней │               │
│  │ − Убрано:            −0ч (−0)  │              │ 🟡 PROJ-89  In Review    4 дня  │               │
│  │ ───────────────────────────────│              │                                 │               │
│  │ Итого сейчас:       120ч (12)  │              │ Среднее время в работе: 2.3 дня │               │
│  │ Изменение scope:    +20% ⚠️    │              └─────────────────────────────────┘               │
│  └────────────────────────────────┘                                                                │
│                                                                                                     │
├─────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                     │
│  ПРОБЛЕМЫ:                                                                                          │
│  ⚠️ PROJ-123: Нет оценки (High priority)                                                           │
│  ⚠️ PROJ-456: Нет исполнителя                                                                      │
│  ⚠️ PROJ-789: Оценка 24ч — слишком большая задача                                                  │
│  ⚠️ PROJ-111: Просрочен due date (был 2024-01-15)                                                  │
│                                                                                                     │
├─────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                     │
│  РАСПРЕДЕЛЕНИЕ ПО УЧАСТНИКАМ:                                                                       │
│  ┌──────────────────────────────────────────────────────┐                                           │
│  │ Иванов И.    ████████████████░░░░  32/40 ч           │                                           │
│  │ Петров П.    ██████████░░░░░░░░░░  20/40 ч           │                                           │
│  │ Сидоров С.   ████████████████████  40/40 ч ⚠️        │                                           │
│  │ Не назначено ████░░░░░░░░░░░░░░░░  8 ч               │                                           │
│  └──────────────────────────────────────────────────────┘                                           │
│                                                                                                     │
├─────────────────────────────────────────────────────────────────────────────────────────────────────┤
│  📋 ВСЕ ЗАДАЧИ СПРИНТА (12) — сортировка по исполнителю:                                           │
│                                                                                                     │
│  ┌────────┬────────────────────┬──────┬───────────┬───────────┬────────┬───────────────────────────┐│
│  │ Ключ   │ Summary            │ Час  │ Начало    │ Конец     │ Статус │ GANTT                     ││
│  ├────────┼────────────────────┼──────┼───────────┼───────────┼────────┼───────────────────────────┤│
│  │        │ ▼ Иванов И. (32ч)  │      │           │           │        │ 09  10  11  12  13  16  17││
│  │ PROJ-1 │ Сделать авториз.   │  8ч  │ 09.12     │ 10.12     │ To Do  │ ████████                  ││
│  │ PROJ-5 │ API интеграция     │ 16ч  │ 11.12     │ 13.12     │ To Do  │         ████████████████  ││
│  │ PROJ-8 │ Тесты              │  8ч  │ 16.12     │ 17.12     │ To Do  │                     ██████││
│  ├────────┼────────────────────┼──────┼───────────┼───────────┼────────┼───────────────────────────┤│
│  │        │ ▼ Петров П. (20ч)  │      │           │           │        │                           ││
│  │ PROJ-2 │ Исправить баг #1   │  4ч  │ 09.12     │ 09.12     │ In Pr  │ ████                      ││
│  │ PROJ-3 │ Исправить баг #2   │  8ч  │ 10.12     │ 11.12     │ To Do  │     ████████              ││
│  │ PROJ-7 │ Рефакторинг        │  8ч  │ 12.12     │ 13.12     │ To Do  │             ████████      ││
│  ├────────┼────────────────────┼──────┼───────────┼───────────┼────────┼───────────────────────────┤│
│  │        │ ▼ Сидоров С. (40ч) │      │           │           │        │                           ││
│  │ PROJ-4 │ Новая фича         │ 24ч  │ 09.12     │ 13.12     │ To Do  │ ████████████████████████  ││
│  │ PROJ-6 │ Документация       │ 16ч  │ 16.12     │ 17.12     │ To Do  │                     ██████││
│  ├────────┼────────────────────┼──────┼───────────┼───────────┼────────┼───────────────────────────┤│
│  │        │ ▼ Не назначено (8ч)│      │           │           │        │                           ││
│  │ PROJ-9 │ Задача без исп.    │  8ч  │ —         │ —         │ To Do  │ ░░░░░░░░░░░░░░░░░░░░░░░░░░││
│  └────────┴────────────────────┴──────┴───────────┴───────────┴────────┴───────────────────────────┘│
│                                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### Цветовая индикация
- 🟢 **Зелёный** (90-100%): Отлично
- 🟡 **Жёлтый** (70-89%): Хорошо, но есть замечания
- 🟠 **Оранжевый** (50-69%): Требует внимания
- 🔴 **Красный** (<50%): Критические проблемы

### Gantt-диаграмма (справа в таблице)
- Горизонтальные полоски по дням спринта
- Цвет полоски зависит от статуса: серый (To Do), синий (In Progress), зелёный (Done)
- Пунктирная полоска — задача без дат (нужно проставить!)
- При наведении — tooltip с деталями

### Интерактивность
- Клик по метрике → показать детали (список проблемных задач)
- Клик по задаче → открыть в Jira
- Hover на участника → показать его задачи
- Группировка таблицы по исполнителю (сворачиваемые секции)
- Drag & drop для изменения дат (V2)

---

## Технические детали

### API Jira
```javascript
// Получить спринты доски
GET /rest/agile/1.0/board/{boardId}/sprint?state=active,future

// Получить задачи спринта
GET /rest/agile/1.0/sprint/{sprintId}/issue?fields=summary,status,assignee,priority,
    issuetype,timeoriginalestimate,timetracking,duedate,customfield_startdate,description,created

// Получить информацию о спринте (даты начала/конца)
GET /rest/agile/1.0/sprint/{sprintId}

// Получить участников доски (если есть)
GET /rest/agile/1.0/board/{boardId}/configuration
```

### Поля для сроков задачи
- **Начало**: `customfield_XXXXX` (Start Date) или первый день спринта
- **Конец**: `duedate` (Due Date)
- Если дат нет — показываем предупреждение в таблице

### Структура файлов
```
ujg-sprint-health.js   — основная логика виджета
ujg-sprint-health.css  — стили
```

### Настройки (сохраняются в localStorage)
- `boardId` — ID доски (выбирается из списка)
- `sprintId` — ID спринта (выбирается из списка)
- `startDateField` — имя custom field для Start Date
- `capacityPerPerson` — часов на человека по умолчанию (например, 40)
- `maxHours` — порог "слишком большой задачи" (например, 16ч)
- `teamMembers` — список участников команды с их capacity

---

## MVP (первая версия)

1. **Верхняя панель**:
   - Выбор спринта (dropdown)
   - Кнопка "Обновить"
   - Кнопка "На весь экран" (Fullscreen)

2. **Базовые метрики**:
   - Всего задач / часов в спринте
   - % оцененных задач
   - % с датами (начало/конец)
   - % с assignee

3. **Burndown chart**:
   - Идеальная линия сгорания
   - Фактический остаток работы

4. **Список проблемных задач**

5. **Таблица всех задач**:
   - Группировка по исполнителю
   - Колонки: Ключ, Summary, Часы, Начало, Конец, Статус
   - Gantt-диаграмма справа (полоски по дням)
   - Сортировка по исполнителю

## V2 (расширенная версия)

1. Capacity planning (настройка команды)
2. Drag & drop сроков в Gantt
3. История спринтов (сравнение)
4. Экспорт в Excel/PDF
5. Автоматические рекомендации
6. Зависимости между задачами на Gantt

---

## Вопросы для уточнения

1. Какое поле используется для Start Date задачи? (customfield_XXXXX)
2. Нужен ли учёт Tempo / capacity команды?
3. Сколько рабочих часов в день считать? (8ч по умолчанию)
4. Какие ещё метрики важны для вашей команды?
